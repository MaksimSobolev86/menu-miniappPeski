<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–µ–Ω—é</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    h2 {
      text-align: center;
    }
    .category-title {
      font-size: 1.2rem;
      margin: 1rem 0 0.5rem 0.5rem;
    }
    .products {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .product {
      width: calc(50% - 0.5rem);
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      text-align: center;
    }
    .product img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
    }
    .product h3 {
      margin: 0.5rem 0;
    }
    .product button {
      background: #1d8ddc;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #submit {
      display: block;
      margin-top: 2rem;
      width: 100%;
      background: #3478f6;
      color: white;
      font-size: 1.2rem;
      padding: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>–ú–µ–Ω—é</h2>
  <div id="products"></div>
  <button id="submit" onclick="submitCart()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>

  <script>
    Telegram.WebApp.ready();

    const sheetUrl = "https://opensheet.vercel.app/1L_ymP4fcpKC-oMuMqDLK1SVMGTnPCtWaSM0fOKW8KJw/menu";
    const cart = [];

    function addToCart(name, price, type) {
      let qty = type.toLowerCase() === '–≥—Ä–∞–º–º—ã' ? 300 : 1;
      cart.push({ name, qty, price });
    }

    function submitCart() {
      if (cart.length === 0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");

      const items = cart.map(i => ({ name: i.name, qty: i.qty, price: i.price }));
      const total = cart.reduce((sum, i) => sum + i.qty * i.price, 0);
      Telegram.WebApp.sendData(JSON.stringify({ items, total }));
      Telegram.WebApp.close();
    }

    function renderCategory(title, items) {
      const container = document.getElementById("products");
      const titleEl = document.createElement("div");
      titleEl.className = "category-title";
      titleEl.textContent = title;
      container.appendChild(titleEl);

      const section = document.createElement("div");
      section.className = "products";

      items.forEach(item => {
        const el = document.createElement("div");
        el.className = "product";
        const img = item.–§–æ—Ç–æ?.trim() || 'https://via.placeholder.com/300x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
        const displayPrice = item.–¢–∏–ø?.toLowerCase() === '–≥—Ä–∞–º–º—ã' ? `${item.–¶–µ–Ω–∞}‚ÇΩ / 100–≥` : `${item.–¶–µ–Ω–∞}‚ÇΩ`;

        el.innerHTML = `
          <img src="${img}" alt="${item.–ù–∞–∑–≤–∞–Ω–∏–µ}" />
          <h3>${item.–ù–∞–∑–≤–∞–Ω–∏–µ}</h3>
          <p>${displayPrice}</p>
          <button onclick="addToCart('${item.–ù–∞–∑–≤–∞–Ω–∏–µ}', ${item.–¶–µ–Ω–∞}, '${item.–¢–∏–ø}')">–î–æ–±–∞–≤–∏—Ç—å</button>
        `;
        section.appendChild(el);
      });

      container.appendChild(section);
    }

    fetch(sheetUrl)
      .then(res => res.json())
      .then(data => {
        const mangal = data.filter(i => i.–¢–∏–ø?.toLowerCase() === '–≥—Ä–∞–º–º—ã');
        const kazan = data.filter(i => i.–¢–∏–ø?.toLowerCase() === '–∫–∞–∑–∞–Ω');
        const banquet = data.filter(i => i.–¢–∏–ø?.toLowerCase() === '–º–µ–Ω—é');

        if (mangal.length) renderCategory("–ú–∞–Ω–≥–∞–ª –º–µ–Ω—é", mangal);
        if (kazan.length) renderCategory("–ö–∞–∑–∞–Ω –º–µ–Ω—é", kazan);
        if (banquet.length) renderCategory("–ë–∞–Ω–∫–µ—Ç–Ω–æ–µ –º–µ–Ω—é", banquet);
      })
      .catch(err => alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é: " + err));
  </script>
</body>
</html>
